import groovy.json.JsonSlurper
import groovy.json.JsonBuilder
import java.net.URLEncoder
import java.net.URL
import groovy.sql.Sql
import java.sql.Driver
import Constants

/*
def String QuerySAPWarengruppe = """
{ "page": 1, "asc": 1, "objectTypeId": 3, "filters": [ { "objectTypeAttributeId": 15, "selectedValues": [ "%" ] } ], "resultsPerPage": 9999, "includeAttributes": true }
"""

def authString = "rest.robot:D)P5LLt+L(*[T&BY".getBytes().encodeBase64().toString()

// Abfrage existierende Warengruppen in Insight, die ObjektIds lassen sich dann anschlieÃŸend anhand der Bezeichnung suchen
HttpURLConnection connSAPWgrp = new URL(Constants.BASE_URL_SMART + "/rest/insight/1.0/object/navlist").openConnection()
connSAPWgrp.setDoOutput(true)
connSAPWgrp.setRequestProperty("Content-Type", "application/json");
connSAPWgrp.setRequestProperty("Authorization", "Basic ${authString}")
wrSAPWgrp = new DataOutputStream(connSAPWgrp.getOutputStream())
wrSAPWgrp.writeBytes(QuerySAPWarengruppe)
wrSAPWgrp.flush()
wrSAPWgrp.close()
InsightSAPWgrp = new groovy.json.JsonSlurper().parse(connSAPWgrp.getInputStream())
HashMap sapWarengruppen = new HashMap()
InsightSAPWgrp.objectEntries.each 
{wgrp ->
  wgrp.attributes.each 
  {attribut ->
    if (attribut.objectTypeAttributeId==15)
    {
      Warengruppe = attribut.objectAttributeValues[0].value
      sapWarengruppen.put(Warengruppe, attribut.id)
    }
  }
}
*/

def public HashMap sapWarengruppen = new HashMap()

def getSapWarengruppeId(String Warengruppe, HashMap sapWarengruppen)
{
	if (sapWarengruppen.containsKey(Warengruppe))
	{
		return sapWarengruppen[Warengruppe]
	}
	else
	{
		sapWarengruppen.put(Warengruppe, sapWarengruppen.size()+1)
		return sapWarengruppen[Warengruppe]
	}
}


sapWarengruppen.put("G100-01",  1)
sapWarengruppen.put("G100-02",  2)
sapWarengruppen.put("G100-03",  3)
sapWarengruppen.put("G200-01", 21)
sapWarengruppen.put("G300-05", 35)
sapWarengruppen.put("G200-01", 22)

println getSapWarengruppeId("G100-01", sapWarengruppen)
println getSapWarengruppeId("G300-05", sapWarengruppen)
println getSapWarengruppeId("X008-15", sapWarengruppen)
println getSapWarengruppeId("G200-01", sapWarengruppen)
println getSapWarengruppeId("G300-06", sapWarengruppen)

def HashMap NeuWarengruppen = new HashMap()

sapWarengruppen.each
{warengruppe->
	NeuWarengruppen.put(warengruppe.key, warengruppe.value)
	println warengruppe.toString() + " " + sapWarengruppen.size() + " " + NeuWarengruppen.size()  
}
println NeuWarengruppen